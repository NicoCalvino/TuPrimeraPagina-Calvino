{% extends 'kiosco/index.html' %}

{% block titulo %}<title>Lista de Usuarios - Sistema</title> {% endblock %}

{% block Bienvenida %} {% endblock %}

{% block content %} 

<div class="container my-5">

    <!-- Encabezado de Página -->
    <div class="mb-4">
        <h2 class="fw-bold text-dark mb-1">Usuarios</h2>
        <p class="text-muted">Listado de personal y administradores registrados</p>
        <div style="width: 50px; height: 5px; background-color: #0d6efd; border-radius: 10px;"></div>
    </div>

    <!-- Filtro de Búsqueda -->
    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-3">
            <form class="d-flex" role="search" method="GET">
                <div class="input-group">
                    <span class="input-group-text bg-light border-0"><i class="bi bi-search"></i></span>
                    <input type="search" name="buscador" class="form-control bg-light border-0" placeholder="Buscar por usuario, email o nombre..." value="{{ request.GET.buscador }}">
                </div>
            </form>
        </div>
    </div>

    <!-- TABLA DE USUARIOS -->
    <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-4 py-3 text-secondary text-uppercase small fw-bold">Usuario</th>
                            <th class="py-3 text-secondary text-uppercase small fw-bold">Nombre Completo</th>
                            <th class="py-3 text-secondary text-uppercase small fw-bold">Email</th>
                            <th class="py-3 text-secondary text-uppercase small fw-bold">Rol</th> <!-- Nueva Columna -->
                            <th class="py-3 text-secondary text-uppercase small fw-bold">Celular</th>
                            <th class="pe-4 py-3 text-end text-secondary text-uppercase small fw-bold">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if usuarios %}
                            {% for usuario in usuarios %}
                            <tr>
                                <!-- Columna: Usuario -->
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        {% if usuario.avatar %}
                                            <img src="{{ usuario.avatar.url }}" alt="Avatar" class="rounded-circle border border-white" style="width: 35px; height: 35px; margin-right: 5px; object-fit: cover;">    
                                        {% else %}
                                            <img src="/media/default/default.png" alt="Avatar" class="rounded-circle border border-white" style="width: 35px; height: 35px; margin-right: 5px; object-fit: cover;">  
                                        {% endif %}
                                        <span class="fw-bold text-dark">@{{ usuario.username }}</span>
                                    </div>
                                </td>

                                <!-- Columna: Nombre Completo -->
                                <td>
                                    <span class="text-dark">{{ usuario.get_full_name|default:usuario.username }}</span>
                                </td>

                                <!-- Columna: Email -->
                                <td>
                                    <span class="text-muted">{{ usuario.email|default:"Sin email" }}</span>
                                </td>

                                <!-- Columna: Rol (NUEVA) -->
                                <td>
                                    {% if usuario.is_superuser %}
                                        <span class="badge rounded-pill bg-primary-subtle text-primary border border-primary-subtle">
                                            Superusuario
                                        </span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-light text-dark border">
                                            Usuario Normal
                                        </span>
                                    {% endif %}
                                </td>

                                <!-- Columna: Celular -->
                                <td>
                                    <span class="text-muted">
                                        <i class="bi bi-phone me-1"></i>
                                        {{ usuario.celular|default:"---" }}
                                    </span>
                                </td>

                                <!-- Columna: Acciones (MODIFICADA) -->
                                <td class="pe-4 text-end">
                                    <a href="{% url 'perfil_usuarios' usuario.pk %}" class="btn btn-outline-primary btn-sm rounded-pill px-3" title="Ver Perfil">
                                        <i class="bi bi-eye-fill me-1"></i> Ver Perfil
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="text-center py-5"> <!-- Colspan aumentado a 6 -->
                                    <div class="text-muted">
                                        <i class="bi bi-people fs-1 opacity-25"></i>
                                        <p class="mt-2">No se encontraron usuarios en la base de datos.</p>
                                    </div>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Ajustes visuales */
    .table thead th {
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }
    .table-hover tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.02);
    }
    .badge {
        font-weight: 500;
        padding: 0.5em 0.8em;
    }
</style>

{% endblock %}